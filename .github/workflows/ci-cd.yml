name: CI/CD Java

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs: 
    ci:
      runs-on: ubuntu-latest
      
      steps:      
        - name: Checkout do código
          uses: actions/checkout@v4

        - name: Configurar Java 17
          uses: actions/setup-java@v4
          with:
            java-version: '17'
            distribution: 'temurin'

        - name: Executar testes
          run: mvn -B test --file pom.xml

    cd:
      needs: ci    

      if: github.ref == 'refs/heads/main'

      runs-on: ubuntu-latest

      steps:
        - name: Checkout do código
          uses: actions/checkout@v4

        - name: Configurar Java 17
          uses: actions/setup-java@v4
          with:
            java-version: '17'
            distribution: 'temurin'

        - name: Gerar JAR para deploy
          run: mvn -B clean package

        - name: Upload JAR para deploy
          uses: actions/upload-artifact@v4
          with:
            name: app-jar
            path: target/*.jar